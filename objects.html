<html>
<head>
    <meta encoding="utf-8">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="x3dom.js"></script>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>

    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="x3dom.css">
    <script src="http://cdn.jquerytools.org/1.2.7/full/jquery.tools.min.js"></script>  

    <script type="text/javascript" src="http://www.outsharked.com/scripts/jquery.imagemapster.js"> </script>
    <link rel="stylesheet" type="text/css" href="style.css" />

    <title>Palace</title>
</head>
<body onLoad="loadCatalog('Tomb Top');">

        <script>

            //
            function highlightArea(key) {
                $('area[name=part-' + key + ']').click();
            }

            function highlightCistern(key) {
                $('area[name=part-' + key + ']').mouseenter();
            }

            // http://stackoverflow.com/questions/13321067/dynamically-resizing-image-maps-and-images
            function loadMap(mapID, imgID, previousWidth) {
                // var ImageMap = function (map, img) {
                //     var n,
                //         areas = map.getElementsByTagName('area'),
                //         len = areas.length,
                //         coords = [];
                    
                //     for (n = 0; n < len; n++) {
                //         coords[n] = areas[n].coords.split(',');
                //     }

                //     this.resize = function () {
                //         var n, m, clen,
                //             x = img.offsetWidth / previousWidth;
                //         for (n = 0; n < len; n++) {
                //             clen = coords[n].length;
                //             for (m = 0; m < clen; m++) {
                //                 coords[n][m] = Math.round(parseInt(coords[n][m], 10) * x);
                //             }
                //             areas[n].coords = coords[n].join(',');
                //         }
                //         previousWidth = img.clientWidth;
                //         return true;
                //     };
                    
                //     window.onresize = this.resize;
                // },
                // imageMap = new ImageMap(document.getElementById(mapID), document.getElementById(imgID));
                // imageMap.resize();

            // http://stackoverflow.com/questions/16735842/responsive-image-map-resizing-with-imagemapster-do-i-misunderstand-what-scalema

                var resizeTime = 100;     // total duration of the resize effect, 0 is instant
                var resizeDelay = 100;    // time to wait before checking the window size again
                                          // the shorter the time, the more reactive it will be.
                                          // short or 0 times could cause problems with old browsers.
                                          
                $('#'+imgID).mapster({
                    mapKey: 'name',
                    singleSelect: true,
                    fillOpacity: 0.6,
                    fillColor: '00FF00'
                }); 

                // Resize the map to fit within the boundaries provided
                function resize(maxWidth,maxHeight) {
                     var image =  $('#' + imgID),
                        imgWidth = image.width(),
                        imgHeight = image.height(),
                        newWidth=0,
                        newHeight=0;

                    if (imgWidth/maxWidth>imgHeight/maxHeight) {
                        newWidth = maxWidth;
                    } else {
                        newHeight = maxHeight;
                    }
                    image.mapster('resize',newWidth,newHeight,resizeTime);   
                }

                // Track window resizing events, but only actually call the map resize when the
                // window isn't being resized any more

                function onWindowResize() {
                    
                    var curWidth = $("#main").width(),
                        curHeight = $("#main").height(),
                        checking=false;
                    if (checking) {
                        return;
                            }
                    checking = true;
                    window.setTimeout(function() {
                        var newWidth = $("#main").width(),
                           newHeight = $("#main").height();
                        if (newWidth === curWidth &&
                            newHeight === curHeight) {
                            resize(newWidth,newHeight); 
                        }
                        checking=false;
                    },resizeDelay );
                }

                $(window).bind('resize',onWindowResize);

                resize( $("#main").width(),  $("#main").height());
            }

            var tombBottom = ["2", "4", "27", "30", "35", "42", "38", "47", "49", "52"];
            var tombTop = ["17", "10", "24"];
            var palaceObjects = ["R46185", "R46631", "R46632", "R50546", "R50547", "R50600"];

            var prefix = "";
            var imgDirectory = "";
            var objectType;
            var current = "";

            function hideEverything() {
                $("#Tomb_17_model_div").hide();

            }

            function loadCatalog(type) {
                hideEverything();
                var htmlString = "";

                if (type == "Tomb" || type == "Tomb Top") {
                    imgDirectory = "tombObjects";
                    prefix = "T.124A-";           
                    objectType = "Tomb";
                // load catalog panel 
                    for (var i = 0; i < tombTop.length; i++) {
                        htmlString += "<p><div id='" + tombTop[i] + "' class='catalog_image' onClick='loadDescription(\"" + tombTop[i] + "\"); loadPlan(\"Tomb Top\"); highlightArea(\"tomb" + tombTop[i] + "\");'><img src='img/" + imgDirectory + "/" + prefix + tombTop[i] + ".png' /></div></p>" 
                    }
                    for (var i = 0; i < tombBottom.length; i++) {
                        htmlString += "<p><div id='" + tombBottom[i] + "' class='catalog_image' onClick='loadDescription(\"" + tombBottom[i] + "\"); loadPlan(\"Tomb\"); highlightArea(\"tomb" + tombBottom[i] + "\");'><img src='img/" + imgDirectory + "/" + prefix + tombBottom[i] + ".png' /></div></p>" 
                    }

                } else {
                    imgDirectory = "palaceObjects";
                    objectType = "Palace"
                    prefix = "";
                    for (var i = 0; i < palaceObjects.length; i++) {
                        htmlString += "<p><div id='" + palaceObjects[i] + "' class='catalog_image' onClick='loadDescription(\"" + palaceObjects[i] + "\"); highlightCistern(\"palace\"); loadPlan(\"Palace\");'><img src='img/" + imgDirectory + "/" + prefix + palaceObjects[i] + ".png' /></div></p>" 
                    }
                }

                loadPlan(type);

                loadIntro(type);

                $("#catalog").html(htmlString);
            }




            function loadPlan(type) {
                if (type == current) {
                    return;
                }
                current = type;
                // load main floor plan and intro
                if (type == "Tomb") {
                    $("#main").load("tombObjectPlan.html", function() {
                        loadMap("tombdownmap", "tombdownimg", 952);
                    });
                } else if (type == "Tomb Top") {
                    $("#main").load("tombObjectPlan2.html", function() {
                        loadMap("tombupmap", "tombupimg", 1029);
                    });                    
                } else {
                    $("#main").load("palaceObjectPlan.html", function(){
                        loadMap("palacemap", "palaceimg", 1000);
                    });
                }
            }

            function loadDescription(name) {
                hideEverything();
                var htmlString = '<h2 id="description_title">' + prefix + name + '</h2>';

                htmlString += '<p> <img class="centered" style="width: 80%;" src="img/'+ imgDirectory + '/' + prefix + name + '.png" /></p>';

                $("#" + objectType + "_" + name + "_model_div").show();

                $("#description_header").html(htmlString);

                $("#description").load("descriptions/" + prefix + name + ".html", function() {
                });
            }

            function loadIntro(type) {
                hideEverything();
                var htmlString = '<h2 id="description_title">' + type + '</h2>';
                $("#description_header").html(htmlString);
                if (type == "Tomb Top") {
                    type = "TombTop";
                }
                $("#description").load("descriptions/intro_object_" + type + ".html", function() {

                });
            }

        </script>

    <header>
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
                <div class="container">
                <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                          </button>
                          <a class="navbar-brand" href="home.html">Palace: B.F8/9 </a>
                    </div>
                    <div class="collapse navbar-collapse">
                        <ul class="nav navbar-nav">
                            <li><a href="home.html">Home</a></li>
                            <li><a href="history.html">History</a></li>
                            <li><a href="palace.html">Palace</a></li>
                            <li><a href="tombpage.html">Tomb</a></li>
                            <li class="active"><a href="#">Objects</a></li>
                            <li><a href="future.html">Future Ideas </a></li>
                            <li><a href="sources.html">Sources</a></li>
                        </ul>
                    </div><!--/.nav-collapse -->
            </div>
        </div>


    </header>


        <div class="row" id="container">

            <div class="col-md-3" id="left" style="height:90%">

            <h3> Catalog of Objects </h3>
            <div id="catalog">

            </div>
            </div>
            <div class="col-md-3" id="main" style="height:90%; overflow:scroll;">

            </div>



            <div class="col-md-6" id="right" style="height:90%">

            <div id="description_header">
                <h2 id="description_title">Description</h2>
            </div>

                <div id="Tomb_17_model_div" width="90%" height="200px" class="centered" style="border: none;">
                    <x3d id="model" showStat='false' showLog='false' width="90%" height="200px" style="border: none;">
                        <scene>
                            <inline nameSpaceName='object' url='object17.x3d'></inline>
                        </scene>
                     </x3d>
                </div>

            <div id="description">


            </div>
            </div>

            <div id="">

                <div style="margin:0 auto; width: 400px; height:120px;">
                <!-- "previous page" action -->
                <div class="object_button" id=""><a class="" style="text-decoration: none;" href="#" onClick="loadCatalog('Palace');"><h3>Palace</h3></a></div>


                <!-- "next page" action -->
                <div class="object_button" id=""><a class="" style="text-decoration: none;" href="#" onClick="loadCatalog('Tomb');"><h3>Tomb Bottom</h3></a> </div>
                </div>

                <div class="object_button" id="other_button"><a class="" style="text-decoration: none;" href="#" onClick="loadCatalog('Tomb Top');"><h3>Tomb Top</h3></a> </div>
                </div>
                <!-- <div class="nav_button" id="reset_button"><a href="#" onClick="resetCurrentView();">Reset Current</a></div> -->
            </div>
        </div>

        </div>

        <div class="clear"></div>

</body>
</html>
